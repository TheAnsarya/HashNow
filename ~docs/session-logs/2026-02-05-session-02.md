# Session Log - 2026-02-05 Session 02

## Summary

Fixed critical bug in HashNow v1.3.2 where the application failed silently when double-clicked in Windows Explorer. Released v1.3.3 with the fix.

## Problem

User reported that double-clicking HashNow.exe v1.3.2 resulted in nothing happening at all - the application failed silently with no error message or UI.

## Root Cause Analysis

The issue was introduced in v1.3.2 when we changed from `OutputType=Exe` to `OutputType=WinExe` to suppress console windows in GUI mode.

### The Bug

The `DetectDoubleClickLaunch()` method was calling `Console.IsInputRedirected` before checking the parent process. When running as WinExe with no console attached (double-click from Explorer):

1. `Console.IsInputRedirected` throws `IOException` because there's no console
2. The exception was caught by the outer try-catch
3. The method returned `false` (assuming CLI mode)
4. The app tried to call `Console.WriteLine()` methods
5. With WinExe and no console, these calls fail silently
6. No GUI dialogs appeared, no errors shown - complete silent failure

### Detection Logic Flow (Broken)

```
Main()
	↓
DetectDoubleClickLaunch()
	↓
Console.IsInputRedirected ← IOException! (no console attached)
	↓
catch → return false (thinks it's CLI mode)
	↓
HandleNoArgumentsConsole() ← tries to use Console methods
	↓
Silent failure (WinExe has no console)
```

## Solution

Reversed the order of detection logic:

1. **Check parent process first** (doesn't require console access)
	- If parent is `explorer.exe` → definitely double-clicked
	- If parent is `cmd`, `powershell`, etc. → definitely CLI
2. **Then check console state** with explicit IOException handling
	- Wrap `Console.IsInputRedirected` in try-catch
	- On IOException → assume double-click (GUI mode)
3. **Changed default behavior** to assume GUI mode when detection fails

### Fixed Detection Logic Flow

```
Main()
	↓
DetectDoubleClickLaunch()
	↓
GetParentProcess()
	↓
	parent == "explorer"? → return true (GUI mode)
	parent == "cmd/powershell"? → return false (CLI mode)
	↓
Try Console.IsInputRedirected
	Success → return !IsInputRedirected
	IOException → return true (no console = GUI mode)
	↓
Default: return true (safer to assume GUI)
```

## Changes Made

### Code Changes

**File:** `Program.cs` - `DetectDoubleClickLaunch()` method

```csharp
// BEFORE (v1.3.2)
private static bool DetectDoubleClickLaunch() {
	try {
		if (Console.IsInputRedirected) {  // ← Throws IOException!
			return false;
		}
		// parent process check...
		return false;  // ← Wrong default
	} catch {
		return false;  // ← Assumes CLI on error
	}
}

// AFTER (v1.3.3)
private static bool DetectDoubleClickLaunch() {
	try {
		// Check parent process FIRST (no console needed)
		using var currentProcess = Process.GetCurrentProcess();
		using var parentProcess = GetParentProcess(currentProcess);
		
		if (parentProcess != null) {
			var parentName = parentProcess.ProcessName.ToLowerInvariant();
			if (parentName == "explorer") return true;      // ✓ GUI
			if (parentName is "cmd" or "powershell"...) return false;  // ✓ CLI
		}
		
		// Then check console state with explicit exception handling
		try {
			if (Console.IsInputRedirected) {
				return false;
			}
		} catch (IOException) {
			// No console attached = likely double-clicked
			return true;  // ✓ Assume GUI
		}
		
		return true;  // ✓ Default to GUI mode
	} catch {
		return true;  // ✓ Safer to assume GUI
	}
}
```

### Version Updates

- Updated version from 1.3.2 → 1.3.3 in:
	- `HashNow.Cli.csproj`
	- `HashNow.Core.csproj`
	- `FileHasher.cs` version constant
	- `CHANGELOG.md`
	- `README.md`

## Testing

### Build & Test Results

```
Build: ✓ Succeeded (0 errors, 1 warning - xUnit1031)
Tests: ✓ 108/108 passed
Publish: ✓ HashNow.exe created (54,430,551 bytes)
```

### Manual Testing

Test scenario: Running from different contexts

| Launch Method | Expected Result | v1.3.2 Result | v1.3.3 Result |
|---------------|----------------|---------------|---------------|
| Double-click in Explorer | GUI dialogs | ❌ Silent failure | ✅ GUI dialogs |
| Right-click context menu | GUI progress | ❌ Console window | ✅ GUI progress |
| `HashNow.exe` from cmd | Console output | ✅ Works | ✅ Works |
| `HashNow.exe --help` | Console help | ✅ Works | ✅ Works |

## Release

**Version:** v1.3.3  
**Tag:** v1.3.3  
**Commit:** b7ef77c  
**Release:** https://github.com/TheAnsarya/HashNow/releases/tag/v1.3.3  
**Download:** HashNow.exe (~52 MB)

### Release Notes

```markdown
### Fixed
- Fixed silent failure when double-clicking exe in Windows Explorer
- Fixed DetectDoubleClickLaunch() method throwing IOException when no console attached
- Improved parent process detection to run before console checks
- Changed default behavior to assume GUI mode when detection fails

### Technical Details
The issue was that Console.IsInputRedirected throws an IOException when called with 
OutputType=WinExe and no console attached. This caused the app to fail silently when 
double-clicked from Explorer.

The fix moves parent process detection (checking for explorer.exe) before any console 
operations, and wraps console checks in a try-catch that assumes GUI mode on IOException.

### Upgrade Notes
This is a critical bug fix. If you experienced issues with v1.3.2 not responding when 
double-clicked, please upgrade to v1.3.3.
```

## Lessons Learned

1. **WinExe Subtlety:** `OutputType=WinExe` suppresses console windows but also makes console operations fail silently rather than throwing visible errors
2. **Order Matters:** Detection logic that relies on console state should run AFTER detection logic that doesn't
3. **Fail Safe:** When detection fails, assume the safer mode (GUI) rather than assuming console mode
4. **Testing Gap:** Need to test double-click scenario explicitly, not just command-line execution

## Impact

**Severity:** Critical - Complete application failure in primary use case  
**Affected Versions:** v1.3.2 only  
**Users Impacted:** Anyone who downloaded and tried to double-click v1.3.2  
**Mitigation:** Immediate patch release (v1.3.3)

## Follow-Up

None required - issue completely resolved in v1.3.3.

## Timeline

- **00:00** - User reports double-click not working
- **00:05** - Root cause identified (IOException in DetectDoubleClickLaunch)
- **00:10** - Fix implemented (reordered detection logic)
- **00:15** - Built, tested, verified fix
- **00:20** - Released v1.3.3

---

**Session Duration:** ~20 minutes  
**Outcome:** ✅ Critical bug fixed and released
